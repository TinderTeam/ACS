<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <link href="../../script/demo.css" rel="stylesheet" type="text/css" />
    <script src="../../scripts/boot.js" type="text/javascript"></script>
    <style type="text/css">
        html, body
        {
            margin: 0;
            padding: 0;
            border: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
    </style>

</head>
<body>
    <div class="mini-fit">
        <div id="tabs1" class="mini-tabs" activeindex="0" style="width: 100%; height: 100%;">
            <div title="根据权限选择">

                <!--- 此处使用方法 url="../AccessManage/LoadAccessListByAccessID" --->
                <ul id="tree1" class="mini-tree" style="width: 100%; height: 80%;" url="AccessList"
                    showtreeicon="true" textfield="text" idfield="id" parentfield="pid" resultastree="false"
                    showcheckbox="true" checkrecursive="true"
                    expandonload="true" allowselect="false" enablehottrack="false">
                </ul>

                <div style="text-align: center; padding: 5px;">
                    <a class="mini-button" onclick="onOk" submittype="access" style="width: 60px; margin-right: 20px;">确定</a>
                    <a class="mini-button" onclick="onCancel" style="width: 60px;">取消</a>
                </div>

            </div>

            <div title="根据设备选择" iconcls="icon-cut">
                <div id="devicespan" class="mini-splitter" style="width: 100%; height: 100%;" allowresize="false">
                    <div showcollapsebutton="true" size="200px">
                        <!----设备树--->

                        <!--- 此处使用方法 url="../AccessManage/LoadDeviceDoorTreeByUserIDandAccessID" --->
                        <ul id="deviceTree" class="mini-tree" url="../Test/DeviceTree.txt" style="width: 100%;height:100%"
                            showtreeicon="true"
                            onnodeclick="onNodeClick()"
                            expandonnodeclick="true"
                            textfield="text" idfield="id" parentfield="pid" resultastree="false">
                        </ul>
                    </div>
                    <div showcollapsebutton="true">
                        <div class="mini-toolbar" style="border-bottom: 0; padding: 0px;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 100%;">
                                        <a class="mini-button" submittype="access" iconcls="icon-add" onclick="add()">增加</a>                                     
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="datagrid" class="mini-datagrid" style="width: 100%; height: 95%;" allowresize="true"
                            url="Load" idfield="UserID" multiselect="true">
                            <div property="columns">
                                <!--<div type="indexcolumn"></div>        -->
                                <div type="checkcolumn"></div>
                               <div field="CreateUserID" width="120" headeralign="center" allowsort="true">控制器名称</div>
                                <div field="CreateDate" width="120" headeralign="center" allowsort="true">门名称</div>
                                <div field="CreateDate" width="120" headeralign="center" allowsort="true">时间段编号</div>
                                <div field="CodifyUserID" width="120" headeralign="center" allowsort="true">开始时间</div>
                                <div field="CodifyDate" width="120" headeralign="center" allowsort="true">截止时间</div>                             
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</body>
<script type="text/javascript">

    mini.parse();
    function SaveAcceessData(type) {

        //获取操作类型（新建/修改）
        var url;
        if (type == 'access') {
            //新建
            url = "/AccessManage/addAccess";
        }
        else if (type == 'datetime') {
            //编辑
            url = "/AccessManage/addDateTime";
        }
        var json = mini.encode(o);
        $.ajax({
            url: url,
            type: 'post',
            data: { data: json },
            cache: false,
            success: function (text) {

                if (text == "Success") {
                    mini.alert("修改成功！");
                    CloseWindow("save");
                }
                else {
                    alert(text);
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert(jqXHR.responseText);
                CloseWindow();
            }
        });
    }

    function CloseWindow(action) {
        if (window.CloseOwnerWindow) return window.CloseOwnerWindow(action);
        else window.close();
    }

    function onOk(e) {
        var type = $(this).attr("submittype");
        SaveAcceessData(type);
    }
    function onCancel(e) {
        CloseWindow("cancel");
    }
</script>

</html>
